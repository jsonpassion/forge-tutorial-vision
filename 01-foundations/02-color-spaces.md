# 색상 공간의 이해

> RGB, HSV, LAB 등 다양한 색상 표현 방식

## 개요

같은 색을 표현하는 방법은 하나가 아닙니다. 모니터는 빛을 섞어 색을 만들고, 화가는 물감의 종류·진하기·밝기로 색을 고르고, 과학자는 사람 눈의 감각에 맞춰 색을 정의합니다. 컴퓨터 비전에서는 **목적에 맞는 색상 표현 방식**을 선택하는 것이 중요합니다.

**선수 지식**: [이미지란 무엇인가](./01-what-is-image.md) — 픽셀, 채널, NumPy 배열 개념
**학습 목표**:
- RGB, HSV, LAB 색상 공간의 차이를 설명할 수 있다
- 각 색상 공간이 유리한 상황을 구분할 수 있다
- OpenCV로 색상 공간을 변환할 수 있다

## 왜 알아야 할까?

"빨간 사과를 찾아라"라는 문제를 생각해 봅시다. RGB에서는 빨간색이 조명에 따라 (255,0,0)일 수도, (180,50,30)일 수도, (120,20,10)일 수도 있습니다. 하지만 HSV로 바꾸면 조명이 달라져도 **색상(Hue) 값은 거의 동일**합니다. 이처럼 적절한 색상 공간을 선택하면 어려운 문제가 쉬워집니다.

객체 추적, 피부색 검출, 이미지 보정, 스타일 변환 등 **CV의 수많은 작업이 색상 공간 선택에 따라 성능이 크게 달라집니다.**

## 핵심 개념

### 1. 색상 공간이란?

> 💡 **비유**: 같은 주소를 **한국어**, **영어**, **일본어**로 쓸 수 있는 것처럼, 같은 색을 **RGB**, **HSV**, **LAB**이라는 서로 다른 "언어"로 표현할 수 있습니다. 어떤 언어가 "더 좋다"가 아니라, **상황에 맞는 언어**가 있을 뿐입니다.

색상 공간(Color Space)은 색을 숫자로 표현하는 **좌표 체계**입니다. 각 색상 공간은 색의 서로 다른 측면을 강조합니다.

### 2. RGB — 빛의 삼원색

> 💡 **비유**: 어두운 무대 위에 **빨간 스포트라이트**, **초록 스포트라이트**, **파란 스포트라이트**가 있다고 상상하세요. 세 빛을 적절히 섞으면 어떤 색이든 만들 수 있습니다. 세 빛을 모두 최대로 켜면? **하얀색**이 됩니다.

RGB는 **R**(Red, 빨강), **G**(Green, 초록), **B**(Blue, 파랑) 세 채널의 빛을 합쳐 색을 만드는 **가산 혼합** 방식입니다. 모니터, 카메라, 스마트폰 등 거의 모든 디스플레이 장치가 이 방식을 씁니다.

| 채널 | 범위 | 의미 |
|------|------|------|
| R (빨강) | 0 ~ 255 | 빨간빛의 세기 |
| G (초록) | 0 ~ 255 | 초록빛의 세기 |
| B (파랑) | 0 ~ 255 | 파란빛의 세기 |

**대표 색상 예시:**

| 색상 | R | G | B | 설명 |
|------|---|---|---|------|
| 🔴 빨강 | 255 | 0 | 0 | R만 최대 |
| 🟢 초록 | 0 | 255 | 0 | G만 최대 |
| 🔵 파랑 | 0 | 0 | 255 | B만 최대 |
| ⬛ 검정 | 0 | 0 | 0 | 모든 빛 꺼짐 |
| ⬜ 하양 | 255 | 255 | 255 | 모든 빛 최대 |
| 🟡 노랑 | 255 | 255 | 0 | R + G |

**RGB의 한계**: 색의 밝기와 색상 정보가 세 채널에 뒤섞여 있어서, "이 색이 빨간 계열인가?"라는 질문에 단순하게 답하기 어렵습니다.

### 3. HSV — 사람이 색을 고르는 방식

> 💡 **비유**: 미술 시간에 선생님이 "어떤 색 쓸래?", "얼마나 진하게?", "얼마나 밝게?" 이렇게 세 가지를 물어보는 것과 같습니다. 이것이 바로 HSV의 세 축입니다.

HSV는 **H**(Hue, 색상), **S**(Saturation, 채도), **V**(Value, 명도)로 색을 표현합니다.

| 채널 | OpenCV 범위 | 의미 |
|------|------------|------|
| **H** (색상) | 0 ~ 179 | *무슨* 색인가 (빨강, 초록, 파랑...) |
| **S** (채도) | 0 ~ 255 | 색이 *얼마나 선명*한가 (0 = 회색, 255 = 순색) |
| **V** (명도) | 0 ~ 255 | *얼마나 밝은*가 (0 = 검정, 255 = 밝음) |

> ⚠️ **주의**: OpenCV에서 H의 범위는 0~179입니다 (일반적인 0~360°의 절반). 이는 8비트(0~255)에 360이 안 맞아서 절반으로 나눈 것입니다.

**HSV의 핵심 장점**: 조명이 변해도 **H(색상) 값은 거의 변하지 않습니다.** 그래서 "빨간색 물체 찾기" 같은 **색 기반 검출**에 매우 유리합니다.

| 색상 | H (색상) | S (채도) | V (명도) |
|------|---------|---------|---------|
| 🔴 빨강 | 0 또는 179 | 255 | 255 |
| 🟠 주황 | 15 | 255 | 255 |
| 🟡 노랑 | 30 | 255 | 255 |
| 🟢 초록 | 60 | 255 | 255 |
| 🔵 파랑 | 120 | 255 | 255 |

> 같은 빨강이라도 어두운 빨강(V 낮음)과 밝은 빨강(V 높음)은 **H 값이 같습니다.** 이것이 RGB 대비 HSV의 가장 큰 강점입니다.

### 4. LAB — 사람의 눈을 모방한 색 체계

> 💡 **비유**: RGB가 "기계의 언어"라면, LAB은 "사람 눈의 언어"입니다. 우리 눈은 밝기 변화에 매우 민감하지만, 빨강-초록의 미세한 차이는 잘 구분하지 못합니다. LAB은 이 **인간의 시각 특성**에 맞춰 설계되었습니다.

| 채널 | 범위 | 의미 |
|------|------|------|
| **L** (밝기) | 0 ~ 100 | 밝기 (0 = 검정, 100 = 흰색) |
| **A** (녹-적) | -128 ~ 127 | 초록(−) ↔ 빨강(+) |
| **B** (청-황) | -128 ~ 127 | 파랑(−) ↔ 노랑(+) |

**LAB의 핵심 장점:**
- **L 채널만 분리하면** 밝기와 색을 완전히 분리할 수 있습니다
- **지각적 균일성** — LAB에서 같은 숫자 차이는 사람 눈에도 비슷한 색 차이로 느껴집니다
- 색 보정, 히스토그램 균일화, 조명 보정에 탁월합니다

### 5. 그레이스케일 — 흑백의 세계

컬러를 흑백으로 바꾸는 것도 색상 공간 변환의 일종입니다. RGB 세 채널을 하나의 밝기 값으로 합칩니다.

> Gray = 0.299 × R + 0.587 × G + 0.114 × B

세 채널의 가중치가 다른 이유는 **사람 눈이 초록빛에 가장 민감**하기 때문입니다. 단순 평균이 아니라 인간 시각에 맞춘 가중 평균을 사용합니다.

### 6. 언제 어떤 색상 공간을 쓸까?

| 작업 | 추천 색상 공간 | 이유 |
|------|--------------|------|
| 화면 표시, 저장 | RGB | 표준 포맷 |
| 색 기반 객체 검출 | **HSV** | 조명에 강건한 색상 분리 |
| 피부색 검출 | **YCrCb** 또는 HSV | 밝기 분리 가능 |
| 조명 보정, 색 보정 | **LAB** | 밝기(L)와 색(A,B) 완전 분리 |
| 에지 검출, 특징 추출 | **Grayscale** | 채널 1개로 연산 효율 |
| 딥러닝 모델 입력 | RGB (대부분) | 사전학습 모델 기준 |

## 실습: 직접 해보기

### 색상 공간 변환 기본

```python
import cv2
import numpy as np

# 이미지 읽기 (OpenCV는 BGR 순서!)
img_bgr = cv2.imread("sample.jpg")

# BGR → 다양한 색상 공간으로 변환
img_rgb = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB)
img_hsv = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2HSV)
img_lab = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2LAB)
img_gray = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2GRAY)

# 각 색상 공간의 형태 확인
print(f"BGR:  {img_bgr.shape}")   # (높이, 너비, 3)
print(f"HSV:  {img_hsv.shape}")   # (높이, 너비, 3)
print(f"LAB:  {img_lab.shape}")   # (높이, 너비, 3)
print(f"Gray: {img_gray.shape}")  # (높이, 너비) — 채널 없음!
```

### HSV로 특정 색상 추출하기

```python
import cv2
import numpy as np

# 이미지 읽기 & HSV 변환
img = cv2.imread("sample.jpg")
hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)

# 빨간색 범위 정의 (H: 0~10 또는 170~179)
lower_red1 = np.array([0, 100, 100])     # 하한 (H, S, V)
upper_red1 = np.array([10, 255, 255])    # 상한

lower_red2 = np.array([170, 100, 100])   # 빨강은 H=0 부근에서 순환
upper_red2 = np.array([179, 255, 255])

# 마스크 생성 (해당 색 범위 = 흰색, 나머지 = 검정)
mask1 = cv2.inRange(hsv, lower_red1, upper_red1)
mask2 = cv2.inRange(hsv, lower_red2, upper_red2)
mask = mask1 + mask2

# 마스크를 이용해 원본에서 빨간 부분만 추출
result = cv2.bitwise_and(img, img, mask=mask)

print(f"마스크 형태: {mask.shape}")      # (높이, 너비) — 흑백
print(f"빨간 픽셀 수: {np.sum(mask > 0)}")
```

### 채널별 분리와 확인

```python
import cv2
import numpy as np

# 이미지 읽기
img = cv2.imread("sample.jpg")

# RGB 채널 분리
b, g, r = cv2.split(img)
print(f"R 채널: min={r.min()}, max={r.max()}, mean={r.mean():.1f}")
print(f"G 채널: min={g.min()}, max={g.max()}, mean={g.mean():.1f}")
print(f"B 채널: min={b.min()}, max={b.max()}, mean={b.mean():.1f}")

# HSV 채널 분리
hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
h, s, v = cv2.split(hsv)
print(f"\nH(색상): min={h.min()}, max={h.max()}")
print(f"S(채도): min={s.min()}, max={s.max()}")
print(f"V(명도): min={v.min()}, max={v.max()}")

# LAB 채널 분리
lab = cv2.cvtColor(img, cv2.COLOR_BGR2LAB)
l, a, b_ch = cv2.split(lab)
print(f"\nL(밝기): min={l.min()}, max={l.max()}")
print(f"A(녹-적): min={a.min()}, max={a.max()}")
print(f"B(청-황): min={b_ch.min()}, max={b_ch.max()}")
```

## 더 깊이 알아보기

### OpenCV BGR 순서 주의

OpenCV는 역사적 이유로 **BGR** 순서를 사용합니다. Matplotlib이나 PyTorch에서 사용하려면 **RGB로 변환**해야 합니다.

```python
import cv2
import matplotlib.pyplot as plt

img_bgr = cv2.imread("sample.jpg")

# Matplotlib에 표시할 때는 반드시 RGB로!
img_rgb = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2RGB)
plt.imshow(img_rgb)
plt.title("RGB로 변환 후 표시")
plt.show()
```

### 세계 최초의 컬러 사진과 HSV의 탄생

> 💡 **알고 계셨나요?**: 세계 최초의 컬러 사진은 1861년 물리학자 **제임스 클러크 맥스웰(James Clerk Maxwell)**이 만들었습니다. 전자기학의 아버지로 유명한 바로 그 맥스웰이죠!

맥스웰은 타탄 리본(tartan ribbon)을 **빨강, 초록, 파랑 필터**를 각각 씌워 흑백 사진 3장으로 촬영한 뒤, 같은 색 필터의 빛으로 동시에 투사하여 하나의 컬러 이미지를 만들어냈습니다. 이것이 바로 우리가 오늘날 사용하는 **RGB 색상 공간의 기원**입니다. 160여 년 전의 실험이 지금까지 이어지고 있다니 놀랍지 않나요?

하지만 RGB는 예술가들에게는 직관적이지 않았습니다. "빨강 200, 초록 150, 파랑 50을 섞으면 무슨 색이 될까?"라고 물으면 대부분 바로 답하기 어렵거든요. 이 문제를 해결하기 위해 컴퓨터 그래픽스의 선구자 **앨비 레이 스미스(Alvy Ray Smith)**가 1978년에 **HSV 색상 공간**을 제안했습니다. "어떤 색(Hue)을, 얼마나 진하게(Saturation), 얼마나 밝게(Value)"라는 방식은 화가가 물감을 고르는 과정과 일치하기 때문에, 그래픽 디자인 도구에서 폭넓게 채택되었습니다. Photoshop의 색상 선택기(Color Picker)가 HSV 기반인 것도 바로 이 이유입니다.

### HSV에서 빨간색이 특별한 이유

HSV의 H(색상)는 **원형 색상 환**을 따릅니다. 빨간색은 0° 근처에 있는데, 원의 시작과 끝이 만나는 지점이라 **0 부근과 179 부근** 두 구간에 걸쳐 있습니다. 그래서 빨간색 검출 시 두 범위를 합쳐야 합니다.

> H 값의 색상 환 (OpenCV 기준):
> - 0~10: 🔴 빨강
> - 11~25: 🟠 주황
> - 26~34: 🟡 노랑
> - 35~85: 🟢 초록
> - 86~125: 🔵 파랑
> - 126~155: 🟣 보라
> - 156~179: 🔴 빨강 (다시 순환)

## 흔한 오해와 팁

> ⚠️ **흔한 오해**: "RGB는 모든 색을 표현할 수 있다"
>
> RGB 모니터에서 볼 수 있는 색은 인간이 실제로 볼 수 있는 색의 **일부분**에 불과합니다. CIE 1931 색도 다이어그램을 보면, RGB 색역(sRGB 삼각형)은 인간 가시 색 영역의 약 35% 정도만 커버하거든요. 특히 깊고 선명한 시안(Cyan)이나 일부 녹색은 sRGB로는 정확히 표현할 수 없습니다. 이것이 P3, Adobe RGB, Rec.2020 같은 넓은 색역(Wide Gamut) 표준이 등장한 이유입니다.

> ⚠️ **흔한 오해**: "HSV와 HSL은 같다"
>
> 이름이 비슷해서 혼동하기 쉬운데요, HSV와 HSL은 **다른 색상 공간**입니다. H(Hue)는 같지만, **S(채도)의 의미**가 다르고, **V(Value)와 L(Lightness)**의 계산 방식도 다릅니다. 예를 들어 HSV에서 순백색은 S=0, V=255이지만, HSL에서는 S=0, L=255입니다. 코드 작성 시 OpenCV는 HSV를 사용하고, 웹(CSS)의 `hsl()` 함수는 HSL을 사용하므로 혼동하지 않도록 주의해야 합니다.

> 🔥 **실무 팁**: 색 기반 객체 검출은 반드시 HSV로!
>
> 실무에서 특정 색상의 물체를 검출해야 할 때(피부색, 빨간 신호등, 노란 안전모 등), RGB 공간에서 작업하면 조명 변화에 매우 취약합니다. **반드시 HSV로 변환한 뒤 H(색상) 채널 기준으로 필터링**하세요. HSV에서는 그늘에 있든 햇빛 아래에 있든 같은 물체의 H 값이 거의 동일하기 때문에, 훨씬 안정적인 검출이 가능합니다. S와 V에 적절한 최솟값 임계치를 설정하면 노이즈도 효과적으로 제거할 수 있습니다.

## 핵심 정리

| 색상 공간 | 구성 | 핵심 특징 | 주요 용도 |
|-----------|------|----------|----------|
| **RGB** | 빨강 + 초록 + 파랑 | 디스플레이 표준, 직관적 | 화면 표시, 딥러닝 입력 |
| **HSV** | 색상 + 채도 + 명도 | 색과 밝기 분리, 조명에 강건 | 색 기반 객체 검출 |
| **LAB** | 밝기 + 녹적축 + 청황축 | 인간 시각 모방, 지각 균일 | 색 보정, 조명 보정 |
| **Grayscale** | 밝기 1채널 | 연산 효율 높음 | 에지 검출, 특징 추출 |

## 다음 섹션 미리보기

색상 공간을 알았으니, 이제 이 이미지들이 **어떤 형식으로 저장되는지** 궁금할 차례입니다. 다음 섹션 **[이미지 형식과 압축](./03-image-formats.md)**에서는 JPEG, PNG, WebP 등의 차이와 압축이 이미지 품질에 미치는 영향을 알아봅니다.

## 참고 자료

- [OpenCV 공식 블로그 - Color Spaces in OpenCV](https://opencv.org/blog/color-spaces-in-opencv/) - RGB, HSV, LAB 변환을 코드와 함께 설명
- [OpenCV 공식 튜토리얼 - Changing Colorspaces](https://docs.opencv.org/4.x/df/d9d/tutorial_py_colorspaces.html) - cvtColor 함수 공식 가이드
- [LearnOpenCV - Color Spaces in OpenCV](https://learnopencv.com/color-spaces-in-opencv-cpp-python/) - 색상 공간별 시각적 비교와 코드
- [HSV 색 공간 - 위키백과](https://ko.wikipedia.org/wiki/HSV_%EC%83%89_%EA%B3%B5%EA%B0%84) - HSV의 수학적 정의와 색상 환
- [CIELAB 색 공간 - 위키백과](https://ko.wikipedia.org/wiki/CIELAB_%EC%83%89_%EA%B3%B5%EA%B0%84) - LAB 색상 공간의 과학적 배경
